<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <title>Silent Arcana - Hands MVP</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./style.css">
</head>

<body>
  <!-- カスタムカーソル -->
  <div class="cursor-wrapper">
    <object type="image/svg+xml" data="./magic-wand.svg" class="magic-wand"></object>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
  </div>

  <h1>Silent Arcana - Hand Tracking MVP</h1>

  <div class="main-content">
    <div class="container">
      <!-- ゲームの読み込みやメッセージ表示 -->
      <div id="loading"></div>

      <!-- カメラ映像 -->
      <div class="video-container">
        <video id="video" width="960" height="600" autoplay playsinline muted></video>
      </div>

      <div id="message"></div>
    </div>

    <!-- ゲーム用のUI -->
    <div id="game-ui">
      <h2>手話学習ゲーム</h2>

      <!-- カメラ操作 -->
      <div class="camera-controls">
        <button id="start-btn">カメラ開始</button>
        <button id="capture-btn" disabled>キャプチャ</button>
      </div>

      <div class="game-info">
        <div id="score-display">スコア: 0</div>
        <div id="gesture-display">手話を実行してください: </div>
        <div id="timer-display">残り時間: 60 秒</div>
      </div>

      <button id="start-game-btn">ゲーム開始</button>
    </div>
  </div>

  <!-- ゲーム終了ダイアログ -->
  <div class="dialog-overlay" style="display: none;">
    <div class="dialog">
      <h3>ゲーム終了！</h3>
      <p>素晴らしいプレイでした！</p>
      <div class="score">スコア: <span id="final-score">0</span></div>
      <button id="restart-btn">もう一度プレイ</button>
    </div>
  </div>

  <!-- カーソルエフェクトのスクリプト -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const cursor = document.querySelector('.cursor-wrapper');
      let lastX = 0;
      let lastY = 0;
      let isMoving = false;
      let moveTimeout;

      // マウスの移動に合わせてカーソルを移動
      window.addEventListener('mousemove', (e) => {
        const posX = e.clientX;
        const posY = e.clientY;

        // 移動距離を計算
        const distance = Math.hypot(posX - lastX, posY - lastY);

        // 移動中フラグを設定
        if (distance > 5) {
          cursor.classList.add('moving');
          clearTimeout(moveTimeout);
          isMoving = true;

          // 粒子の角度をランダムに設定
          cursor.style.setProperty('--particle-angle', `${Math.random() * 90}deg`);
        }

        // 移動が止まったら少し待ってからmovingクラスを削除
        moveTimeout = setTimeout(() => {
          cursor.classList.remove('moving');
          isMoving = false;
        }, 100);

        // 杖の先端（25,25）がマウス位置に来るように調整
        cursor.style.transform = `translate(${posX - 25}px, ${posY - 25}px)`;

        lastX = posX;
        lastY = posY;
      });

      // クリック時のエフェクト
      window.addEventListener('mousedown', () => {
        document.body.classList.add('cursor-clicking');
      });

      window.addEventListener('mouseup', () => {
        document.body.classList.remove('cursor-clicking');
      });

      // カーソルが画面外に出た時は非表示
      document.addEventListener('mouseleave', () => {
        cursor.style.opacity = '0';
      });

      document.addEventListener('mouseenter', () => {
        cursor.style.opacity = '1';
      });
    });
  </script>

  <!-- バンドル後のJS -->
  <script src="./bundle.js"></script>
</body>

</html>